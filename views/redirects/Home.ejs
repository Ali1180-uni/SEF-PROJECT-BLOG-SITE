<% layout('/includes/boilerplate') %>
<div id="top"></div>
<header>
  <h1 class="page-title">Welcome to Blogify</h1>
  <p class="page-subtitle">Discover amazing stories and share your thoughts</p>
  <% if (currUser) { %>
    <form action="/blogs/new" method="get">
      <button class="newButton"><i class="fa-solid fa-book"></i> Create New Blog</button>
    </form>
  <% } else { %>
    <!-- Hit the protected route so isLoggedIn stores redirectUrl=/blogs/new and flashes -->
    <form action="/blogs/new" method="get">
      <button class="newButton" type="submit">
        <i class="fa-solid fa-lock"></i> Login to Create Blog
      </button>
    </form>
  <% } %>

  <div id="blogs" class="blogs-section">
    <h2 class="section-heading">All Blogs</h2>
    <% for(let blogs of blog){ %>
    <div class="Blog-Container">
      <h1 class="topic"><i class="fas fa-tag"></i> <%= blogs.topic %></h1>
      <a href="/blogs/<%= blogs.id %>" style="text-decoration: none; color: inherit;">
        <h3 class="title" style="cursor: pointer; transition: color 0.3s;" 
            onmouseover="this.style.color='#007bff'" 
            onmouseout="this.style.color='inherit'">
          <%= blogs.title %>
        </h3>
      </a>
      <div class="content"><%- blogs.content.substring(0, 200) %>...</div>
      <div class="blog-meta">
        <span class="timestamp">
          <i class="far fa-clock"></i>
          <%= new Date(blogs.createdAt).toLocaleTimeString('en-US', {hour: '2-digit',minute: '2-digit',hour12: true}) %>
        </span>
        <span class="date">
          <i class="far fa-calendar"></i>
          <%= blogs.createdAt.toString().split(" ").slice(0, 4).join("-") %>
        </span>
        <span class="likes">
          <i class="fas fa-heart" style="color: #e74c3c;"></i>
          <%= blogs.likes.length %> <%= blogs.likes.length === 1 ? 'Like' : 'Likes' %>
        </span>
      </div>
      <div style="margin: 15px 0;">
        <a href="/blogs/<%= blogs.id %>" class="btn btn-primary" style="text-decoration: none;">
          <i class="fas fa-book-open"></i> Read More
        </a>
      </div>
      <% if (currUser && currUser._id.equals(blogs.author._id)) { %>
          <span class="inline">
            <form action="/blogs/<%= blogs.id %>/edit" method="get">
              <button class="editButton"><i class="fas fa-edit"></i> Edit</button>
            </form>
          </span>
          <span class="inline">
            <form action="/blogs/<%= blogs.id %>?_method=DELETE" method="post">
              <button class="deleteButton"><i class="fas fa-trash-alt"></i> Delete</button>
            </form>
          </span>
      <% } %>
    </div>
    <% } %>
  </div>
</header>